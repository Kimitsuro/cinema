{% extends 'base.html.twig' %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä –°–∞–∫—É—Ä–∞{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/admin.css') }}?v={{ "now"|date("U") }}">
{% endblock %}

{% block body %}
    <!-- Main Content -->
    <main class="main-content">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <h2 class="sidebar-title">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-linck active" data-section="dashboard">
                            <span class="nav-icon">üìä</span>
                            <span>–î–∞—à–±–æ—Ä–¥</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-linck" data-section="movies">
                            <span class="nav-icon">üé¨</span>
                            <span>–§–∏–ª—å–º—ã</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-linck" data-section="halls">
                            <span class="nav-icon">üèõÔ∏è</span>
                            <span>–ó–∞–ª—ã</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-linck" data-section="employees">
                            <span class="nav-icon">üë•</span>
                            <span>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-linck" data-section="reports">
                            <span class="nav-icon">üìà</span>
                            <span>–û—Ç—á—ë—Ç—ã</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Section -->
            <section class="content-section active" data-section="dashboard">
                <h1 class="section-title">–î–∞—à–±–æ—Ä–¥</h1>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.totalMovies }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —Ñ–∏–ª—å–º–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.activeHalls }}</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ª–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.totalEmployees }}</div>
                        <div class="stat-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.totalRevenue|number_format(0, '.', ' ') }} ‚ÇΩ</div>
                       

                        <div class="stat-label">–í—ã—Ä—É—á–∫–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.ticketsSold }}</div>
                        <div class="stat-label">–ë–∏–ª–µ—Ç–æ–≤ –ø—Ä–æ–¥–∞–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.averageOccupancy }}%</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –∑–∞–ø–æ–ª–Ω—è–µ–º–æ—Å—Ç—å</div>
                    </div>
                </div>
            </section>

            <!-- Movies Section -->
            <section class="content-section" data-section="movies">
                <h1 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å–º–∞–º–∏</h1>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤</div>
                        <div class="table-actions">
                            <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤...">
                            <button class="btn btn-primary" onclick="openMovieModal()">+ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</button>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–ü–æ—Å—Ç–µ—Ä</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ñ–∞–Ω—Ä</th>
                                <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                                <th>–í–æ–∑—Ä–∞—Å—Ç</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for movie in movies %}
                            <tr>
                                <td>
                                    <img src="{{ movie.moviePoster ?: '/placeholder.svg?height=60&width=40' }}" alt="–ü–æ—Å—Ç–µ—Ä" style="border-radius: 4px;">
                                </td>
                                <td>{{ movie.movieTitle }}</td>
                                <td>{{ movie.movieGenre }}</td>
                                <td>{{ movie.movieDuration }} –º–∏–Ω</td>
                                <td>{{ movie.movieAge }}+</td>
                                <td>
                                    <span class="status-badge {{ movie.status }}">
                                        {{ movie.status == 'current' ? '–ê–∫—Ç–∏–≤–Ω—ã–π' : movie.status == 'upcoming' ? '–°–∫–æ—Ä–æ' : '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π' }}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-secondary btn-small" onclick="editMovie({{ movie.id }})">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                                    <button class="btn btn-danger btn-small" onclick="deleteMovie({{ movie.id }})">–£–¥–∞–ª–∏—Ç—å</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Halls Section -->
            <section class="content-section" data-section="halls">
                <h1 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ª–∞–º–∏</h1>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–ª–æ–≤</div>
                        <div class="table-actions">
                            <button class="btn btn-primary" onclick="openHallModal()">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ª</button>
                        </div>
                    </div>
                    
                    {% for hall in halls %}
                    <div class="hall-config">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div>
                                <h3 style="color: var(--accent-gold);">–ó–∞–ª {{ hall.id }} - {{ hall.hallType }}</h3>
                                <p style="color: var(--text-secondary);">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {{ hall.hallCapacity }} –º–µ—Å—Ç ‚Ä¢ {{ hall.hallType == '2D' ? '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π' : hall.hallType == '3D' ? '–û–±—ä—ë–º–Ω—ã–π' : '–ü—Ä–µ–º–∏—É–º' }} —Ñ–æ—Ä–º–∞—Ç</p>
                            </div>
                            <div>
                                <button class="btn btn-secondary btn-small" onclick="editHall({{ hall.id }})">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button>
                                <button class="btn btn-danger btn-small" onclick="deleteHall({{ hall.id }})">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="background: var(--secondary-dark); padding: 0.5rem; border-radius: 4px; margin-bottom: 1rem; color: var(--text-muted);">
                                –≠–ö–†–ê–ù
                            </div>
                            <div class="seat-grid">
                                {% for seat in hall.seats %}
                                <div class="seat-preview {{ seat.seatType }}">{{ seat.searNumber }}</div>
                                {% endfor %}
                            </div>
                            <div style="margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                                <span style="color: #4a90e2;">‚ñ†</span> –≠–∫–æ–Ω–æ–º ({{ hall.seats|filter(seat => seat.seatType == 'economy')|length }} –º–µ—Å—Ç) ‚Ä¢ 
                                <span style="color: #50c878;">‚ñ†</span> –û–±—ã—á–Ω—ã–µ ({{ hall.seats|filter(seat => seat.seatType == 'regular')|length }} –º–µ—Å—Ç)
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <!-- Employees Section -->
            <section class="content-section" data-section="employees">
                <h1 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h1>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                        <div class="table-actions">
                            <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...">
                            <button class="btn btn-primary" onclick="openEmployeeModal()">+ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–ò–º—è</th>
                                <th>–õ–æ–≥–∏–Ω</th>
                                <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for employee in employees %}
                            <tr>
                                <td>{{ employee.employeeName }}</td>
                                <td>{{ employee.employeeLogin }}</td>
                                <td>{{ employee.employeePosition }}</td>
                                <td>
                                    <span class="status-badge active">–ê–∫—Ç–∏–≤–Ω—ã–π</span>
                                </td>
                                <td>
                                    <button class="btn btn-secondary btn-small" onclick="editEmployee('{{ employee.employeeLogin }}')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                                    <button class="btn btn-danger btn-small" onclick="deleteEmployee('{{ employee.employeeLogin }}')">–£–¥–∞–ª–∏—Ç—å</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Pricing Section -->
            <section class="content-section" data-section="pricing">
                <h1 class="section-title">–¶–µ–Ω–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞</h1>
                
                <div class="pricing-grid">
                    <div class="pricing-card">
                        <div class="pricing-title">–ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –ø–æ —Ç–∏–ø–∞–º –º–µ—Å—Ç</div>
                        <div class="price-item">
                            <span class="price-label">–≠–∫–æ–Ω–æ–º –º–µ—Å—Ç–∞</span>
                            <input type="number" class="price-input" value="{{ pricing.economyPrice ?? 350 }}">
                            <span style="color: var(--text-muted); margin-left: 0.5rem;">‚ÇΩ</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">–û–±—ã—á–Ω—ã–µ –º–µ—Å—Ç–∞</span>
                            <input type="number" class="price-input" value="{{ pricing.regularPrice ?? 400 }}">
                            <span style="color: var(--text-muted); margin-left: 0.5rem;">‚ÇΩ</span>
                        </div>
                    </div>

                    <div class="pricing-card">
                        <div class="pricing-title">–ù–∞–¥–±–∞–≤–∫–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º</div>
                        <div class="price-item">
                            <span class="price-label">2D —Ñ–æ—Ä–º–∞—Ç</span>
                            <span class="price-value">–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">3D —Ñ–æ—Ä–º–∞—Ç</span>
                            <input type="number" class="price-input" value="{{ pricing.format3DPrice ?? 100 }}">
                            <span style="color: var(--text-muted); margin-left: 0.5rem;">‚ÇΩ</span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">IMAX —Ñ–æ—Ä–º–∞—Ç</span>
                            <input type="number" class="price-input" value="{{ pricing.imaxPrice ?? 200 }}">
                            <span style="color: var(--text-muted); margin-left: 0.5rem;">‚ÇΩ</span>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="savePricing()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    <button class="btn btn-secondary" onclick="resetPricing()">–°–±—Ä–æ—Å–∏—Ç—å –∫ —É–º–æ–ª—á–∞–Ω–∏—é</button>
                </div>
            </section>

            <!-- Reports Section -->
            <section class="content-section" data-section="reports">
                <h1 class="section-title">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤</h1>
                
                <div class="report-filters">
                    <select class="form-select" style="width: auto;" id="reportPeriod">
                        <option value="7 days">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</option>
                        <option value="1 month">–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</option>
                        <option value="3 months">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞</option>
                        <option value="1 year">–¢–µ–∫—É—â–∏–π –≥–æ–¥</option>
                        <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                    </select>
                    <input type="date" class="form-input" style="width: auto;" id="reportStartDate" value="{{ "now"|date_modify("-7 days")|date('Y-m-d') }}">
                    <input type="date" class="form-input" style="width: auto;" id="reportEndDate" value="{{ "now"|date('Y-m-d') }}">
                    <button class="btn btn-primary" onclick="updateReport()">–û–±–Ω–æ–≤–∏—Ç—å –æ—Ç—á—ë—Ç</button>
                    <button class="btn btn-success">üìä –≠–∫—Å–ø–æ—Ä—Ç Excel</button>
                    <button class="btn btn-secondary export-pdf-btn">üìÑ –≠–∫—Å–ø–æ—Ä—Ç PDF</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ reportStats.totalRevenue|number_format(0, '.', ' ') }} ‚ÇΩ</div>
                        <div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ reportStats.ticketsSold }}</div>
                        <div class="stat-label">–ë–∏–ª–µ—Ç–æ–≤ –ø—Ä–æ–¥–∞–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ reportStats.averageOccupancy }}%</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –∑–∞–ø–æ–ª–Ω—è–µ–º–æ—Å—Ç—å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ reportStats.averageCheck }} ‚ÇΩ</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ñ–∏–ª—å–º–∞–º</div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–§–∏–ª—å–º</th>
                                <th>–°–µ–∞–Ω—Å–æ–≤</th>
                                <th>–ë–∏–ª–µ—Ç–æ–≤ –ø—Ä–æ–¥–∞–Ω–æ</th>
                                <th>–í—ã—Ä—É—á–∫–∞</th>
                                <th>–ó–∞–ø–æ–ª–Ω—è–µ–º–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in movieReports %}
                            <tr>
                                <td>{{ report.movieTitle }}</td>
                                <td>{{ report.sessionCount }}</td>
                                <td>{{ report.ticketsSold }}</td>
                                <td>{{ report.revenue|number_format(0, '.', ' ') }} ‚ÇΩ</td>
                                <td>{{ report.occupancy }}%</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </main>

    <!-- Movie Modal -->
    <div class="modal" id="movieModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="movieModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</h3>
                <button class="modal-close" onclick="closeMovieModal()">√ó</button>
            </div>
            
            <form id="movieForm">
                <input type="hidden" id="movie_id">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="movie_title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</label>
                        <input type="text" id="movie_title" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="movie_genre">–ñ–∞–Ω—Ä</label>
                        <select id="movie_genre" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä</option>
                            <option value="–î—Ä–∞–º–∞">–î—Ä–∞–º–∞</option>
                            <option value="–ö–æ–º–µ–¥–∏—è">–ö–æ–º–µ–¥–∏—è</option>
                            <option value="–ë–æ–µ–≤–∏–∫">–ë–æ–µ–≤–∏–∫</option>
                            <option value="–¢—Ä–∏–ª–ª–µ—Ä">–¢—Ä–∏–ª–ª–µ—Ä</option>
                            <option value="–†–æ–º–∞–Ω—Ç–∏–∫–∞">–†–æ–º–∞–Ω—Ç–∏–∫–∞</option>
                            <option value="–£–∂–∞—Å—ã">–£–∂–∞—Å—ã</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="movie_duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)</label>
                        <input type="number" id="movie_duration" class="form-input" min="60" max="300" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="movie_age">–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ</label>
                        <select id="movie_age" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç</option>
                            <option value="0">0+</option>
                            <option value="6">6+</option>
                            <option value="12">12+</option>
                            <option value="16">16+</option>
                            <option value="18">18+</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="movie_format">–§–æ—Ä–º–∞—Ç</label>
                        <select id="movie_format" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç</option>
                            <option value="2D">2D</option>
                            <option value="3D">3D</option>
                            <option value="IMAX">IMAX</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="movie_status">–°—Ç–∞—Ç—É—Å</label>
                        <select id="movie_status" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å</option>
                            <option value="current">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                            <option value="upcoming">–°–∫–æ—Ä–æ</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="movie_poster">URL –ø–æ—Å—Ç–µ—Ä–∞</label>
                    <input type="input" id="movie_poster" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="movie_description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="movie_description" class="form-textarea" rows="4"></textarea>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeMovieModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary" id="movieSubmitBtn">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hall Modal -->
    <div class="modal" id="hallModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="hallModalTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ª–∞</h3>
                <button class="modal-close" onclick="closeHallModal()">√ó</button>
            </div>
            
            <form id="hallForm">
                <input type="hidden" id="hall_id">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="hall_type">–¢–∏–ø –∑–∞–ª–∞</label>
                        <select id="hall_type" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="2D">2D</option>
                            <option value="3D">3D</option>
                            <option value="IMAX">IMAX</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="hall_capacity">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</label>
                        <input type="number" id="hall_capacity" class="form-input" min="20" max="100" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="hall_rows">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤</label>
                        <input type="number" id="hall_rows" class="form-input" min="3" max="10" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="seats_per_row">–ú–µ—Å—Ç –≤ —Ä—è–¥—É</label>
                        <input type="number" id="seats_per_row" class="form-input" min="4" max="12" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –º–µ—Å—Ç</label>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <div>
                            <label class="form-label" for="economy_seats">–≠–∫–æ–Ω–æ–º –º–µ—Å—Ç</label>
                            <input type="number" id="economy_seats" class="form-input" min="0">
                        </div>
                        <div>
                            <label class="form-label" for="regular_seats">–û–±—ã—á–Ω—ã—Ö –º–µ—Å—Ç</label>
                            <input type="number" id="regular_seats" class="form-input" min="0">
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeHallModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary" id="hallSubmitBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Employee Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="employeeModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
                <button class="modal-close" onclick="closeEmployeeModal()">√ó</button>
            </div>
            
            <form id="employeeForm">
                <input type="hidden" id="employee_id">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="employee_name">–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                        <input type="text" id="employee_name" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="employee_login">–õ–æ–≥–∏–Ω</label>
                        <input type="text" id="employee_login" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="employee_position">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                        <select id="employee_position" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–ª–∂–Ω–æ—Å—Ç—å</option>
                            <option value="–ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä">–ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="–ú–µ–Ω–µ–¥–∂–µ—Ä">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="employee_password">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="employee_password" class="form-input">
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeEmployeeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary" id="employeeSubmitBtn">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        // Navigation
        document.querySelectorAll('.nav-linck').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.nav-linck').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                this.classList.add('active');
                const sectionName = this.dataset.section;
                document.querySelector(`.content-section[data-section="${sectionName}"]`).classList.add('active');
            });
        });

        // Movie Modal Functions
        function openMovieModal(movieId = null) {
            const modal = document.getElementById('movieModal');
            const title = document.getElementById('movieModalTitle');
            const submitBtn = document.getElementById('movieSubmitBtn');
            const form = document.getElementById('movieForm');
            
            if (movieId) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å–º';
                submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                fetch(`/admin/movies/${movieId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('movie_id').value = data.id;
                        document.getElementById('movie_title').value = data.movieTitle;
                        document.getElementById('movie_genre').value = data.movieGenre;
                        document.getElementById('movie_duration').value = data.movieDuration;
                        document.getElementById('movie_age').value = data.movieAge;
                        document.getElementById('movie_format').value = data.movieFormat;
                        document.getElementById('movie_status').value = data.status;
                        document.getElementById('movie_poster').value = data.moviePoster;
                        document.getElementById('movie_description').value = data.movieDescription;
                    });
            } else {
                title.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º';
                submitBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º';
                form.reset();
                document.getElementById('movie_id').value = '';
            }
            
            modal.classList.add('active');
        }

        function closeMovieModal() {
            document.getElementById('movieModal').classList.remove('active');
        }

        function editMovie(movieId) {
            openMovieModal(movieId);
        }

        function deleteMovie(movieId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∏–ª—å–º?')) {
                fetch(`/admin/movies/${movieId}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            alert('–§–∏–ª—å–º —É–¥–∞–ª—ë–Ω');
                            window.location.reload();
                        } else {
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∏–ª—å–º–∞');
                        }
                    });
            }
        }

        // Hall Modal Functions
        function openHallModal(hallId = null) {
            const modal = document.getElementById('hallModal');
            const title = document.getElementById('hallModalTitle');
            const submitBtn = document.getElementById('hallSubmitBtn');
            const form = document.getElementById('hallForm');
            
            if (hallId) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ª';
                submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                fetch(`/admin/halls/${hallId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('hall_id').value = data.id;
                        document.getElementById('hall_type').value = data.hallType;
                        document.getElementById('hall_capacity').value = data.hallCapacity;
                        document.getElementById('hall_rows').value = data.rows;
                        document.getElementById('seats_per_row').value = data.seatsPerRow;
                        document.getElementById('economy_seats').value = data.economySeats;
                        document.getElementById('regular_seats').value = data.regularSeats;
                    });
            } else {
                title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ª';
                submitBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ª';
                form.reset();
                document.getElementById('hall_id').value = '';
            }
            
            modal.classList.add('active');
        }

        function closeHallModal() {
            document.getElementById('hallModal').classList.remove('active');
        }

        function editHall(hallId) {
            openHallModal(hallId);
        }

        function deleteHall(hallId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–ª?')) {
                fetch(`/admin/halls/${hallId}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            alert('–ó–∞–ª —É–¥–∞–ª—ë–Ω');
                            window.location.reload();
                        } else {
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ª–∞');
                        }
                    });
            }
        }

        // Employee Modal Functions
        function openEmployeeModal(employeeId = null) {
            const modal = document.getElementById('employeeModal');
            const title = document.getElementById('employeeModalTitle');
            const submitBtn = document.getElementById('employeeSubmitBtn');
            const form = document.getElementById('employeeForm');
            
            if (employeeId) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
                submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                fetch(`/admin/employees/${employeeId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('employee_id').value = data.employeeLogin;
                        document.getElementById('employee_name').value = data.employeeName;
                        document.getElementById('employee_login').value = data.employeeLogin;
                        document.getElementById('employee_position').value = data.employeePosition;
                        document.getElementById('employee_password').value = '';
                    });
            } else {
                title.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
                submitBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
                form.reset();
                document.getElementById('employee_id').value = '';
            }
            
            modal.classList.add('active');
        }

        function closeEmployeeModal() {
            document.getElementById('employeeModal').classList.remove('active');
        }

        function editEmployee(employeeId) {
            openEmployeeModal(employeeId);
        }

        function deleteEmployee(employeeId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?')) {
                fetch(`/admin/employees/${employeeId}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            alert('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–¥–∞–ª—ë–Ω');
                            window.location.reload();
                        } else {
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
                        }
                    });
            }
        }

        // Form submissions
        document.getElementById('movieForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const movieId = document.getElementById('movie_id').value;
            const method = movieId ? 'PUT' : 'POST';
            const url = movieId ? `/admin/movies/${movieId}` : '/admin/movies';
            const data = {
                movieTitle: document.getElementById('movie_title').value,
                movieGenre: document.getElementById('movie_genre').value,
                movieDuration: document.getElementById('movie_duration').value,
                movieAge: document.getElementById('movie_age').value,
                movieFormat: document.getElementById('movie_format').value,
                status: document.getElementById('movie_status').value,
                moviePoster: document.getElementById('movie_poster').value,
                movieDescription: document.getElementById('movie_description').value
            };
            
            fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    alert('–§–∏–ª—å–º —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
                    window.location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å–º–∞');
                }
            });
            closeMovieModal();
        });

        document.getElementById('hallForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const hallId = document.getElementById('hall_id').value;
            const method = hallId ? 'PUT' : 'POST';
            const url = hallId ? `/admin/halls/${hallId}` : '/admin/halls';
            const data = {
                hallType: document.getElementById('hall_type').value,
                hallCapacity: document.getElementById('hall_capacity').value,
                rows: document.getElementById('hall_rows').value,
                seatsPerRow: document.getElementById('seats_per_row').value,
                economySeats: document.getElementById('economy_seats').value,
                regularSeats: document.getElementById('regular_seats').value
            };
            
            fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    alert('–ó–∞–ª —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!');
                    window.location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–ª–∞');
                }
            });
            closeHallModal();
        });

        document.getElementById('employeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const employeeId = document.getElementById('employee_id').value;
            const method = employeeId ? 'PUT' : 'POST';
            const url = employeeId ? `/admin/employees/${employeeId}` : '/admin/employees';
            const data = {
                employeeName: document.getElementById('employee_name').value,
                employeeLogin: document.getElementById('employee_login').value,
                employeePosition: document.getElementById('employee_position').value,
                employeePassword: document.getElementById('employee_password').value
            };
            
            fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    alert('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
                    window.location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞');
                }
            });
            closeEmployeeModal();
        });

        // Pricing functions
        function savePricing() {
            const data = {
                economyPrice: document.querySelector('input[value="{{ pricing.economyPrice ?? 350 }}"]').value,
                regularPrice: document.querySelector('input[value="{{ pricing.regularPrice ?? 400 }}"]').value,
                format3DPrice: document.querySelector('input[value="{{ pricing.format3DPrice ?? 100 }}"]').value,
                imaxPrice: document.querySelector('input[value="{{ pricing.imaxPrice ?? 200 }}"]').value
            };
            
            fetch('/admin/pricing', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    alert('–¶–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                    window.location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ü–µ–Ω');
                }
            });
        }

        function resetPricing() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å —Ü–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                fetch('/admin/pricing/reset', { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            alert('–¶–µ–Ω—ã —Å–±—Ä–æ—à–µ–Ω—ã!');
                            window.location.reload();
                        } else {
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Ü–µ–Ω');
                        }
                    });
            }
        }

        // Report functions
        function updateReport() {
            const period = document.getElementById('reportPeriod').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            fetch(`/admin/reports?period=${period}&startDate=${startDate}&endDate=${endDate}`)
                .then(response => response.json())
                .then(data => {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ —á–µ—Ä–µ–∑ AJAX (–¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM)
                    window.location.reload();
                });
        }

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Search functionality
        document.querySelectorAll('.search-input').forEach(input => {
            input.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const table = this.closest('.table-container').querySelector('.data-table tbody');
                const rows = table.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
        });

        // Price inputs validation
        document.querySelectorAll('.price-input').forEach(input => {
            input.addEventListener('change', function() {
                if (this.value < 0) this.value = 0;
                if (this.value > 10000) this.value = 10000;
            });
        });
        document.querySelector('.btn.btn-success').addEventListener('click', function() {
            const period = document.getElementById('reportPeriod').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            window.location.href = `/admin/reports/export/excel?period=${period}&startDate=${startDate}&endDate=${endDate}`;
        });

        document.querySelector('.export-pdf-btn').addEventListener('click', function() {
            const period = document.getElementById('reportPeriod').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            window.location.href = `/admin/reports/export/pdf?period=${period}&startDate=${startDate}&endDate=${endDate}`;
        });
    </script>
{% endblock %}